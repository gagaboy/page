<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link href="/page/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/page/lib/bootstrap/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="/page/lib/bootstrap/css/animate.css" rel="stylesheet">
    <link href="/page/lib/bootstrap/css/style.css" rel="stylesheet">
    <link href="/page/src/css/page.css" rel="stylesheet">

    <link href="/page/lib/bootstrap/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="/page/lib/bootstrap/css/plugins/iCheck/green.png" rel="stylesheet">
    <link href="/page/lib/bootstrap/css/plugins/iCheck/green@2x.png" rel="stylesheet">
</head>
<body>
<br>
<div class="container">
    <div class="row">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-md-12" id="ops" style="padding-bottom: 30px;">
                        <a class="btn btn-primary" href="javascript:addRow();">新增行</a>
                        <a class="btn btn-primary" href="javascript:delCheckedRow();">删除所选行</a>
                        <a class="btn btn-primary" href="javascript:delCustomRow(141);">删除值AACode为141的行</a>
                        * 单击属性进行编辑
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12" id="simpleGrid">

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<script src="/page/bower_components/mootools/dist/mootools-core.js"></script>
<script src="/page/bower_components/jquery/dist/jquery.js"></script>
<script>
    $.noConflict();
</script>
<script src="/page/bower_components/avalon/avalon.js"></script>
<script>
    var simpleGrid = null;
    require(["../../../page/src/Bootstrap"], function () {
        var ds = Page.create("dataSet", {
            $id: 'sampleGridDataSet',
            fetchUrl: 'simpleGrid.demo.json',
            syncUrl: ''
        });


        simpleGrid = Page.create("simpleGrid", {
            $parentId: 'simpleGrid',
            idField:"aa",
            totalNum:200,
            showCheckbox:true,
            usePager:true,
            allChecked:false,
            dataSetId: ds.getId(),
            columns:[
                {title:"姓名",dataField:"name",width:"8%",orderType:"asc",disabledEdit:true},
                {title:"性别编码",dataField:"sex",orderType:"asc"},//编码
                {title:"性别",dataField:"sex",showDisplay:true,sortDisabled:true},//显示Display字段
                {title:"出生年月",dataField:"birthDate",orderType:"desc",xtype:"date"},
                {title:"入学时间",dataField:"rxDate"},
                {title:"是否党员",dataField:"isParty"},
                {title:"所在班级",dataField:"className"},
                {title:"备注",dataField:"notes",sortDisabled:true}
            ],
            data:[
                {"name":"王菜菜","sex":001,"sexDisplay":"男","birthDate":1988-09-20,
                    "rxDate":"2007-09-02",isParty:"是","className":"信息0701班","notes":"朝鲜族",
                    "editContent_sex":"XXX","state":"edit"},
                {"name":"张菜菜","sex":002,"sexDisplay":"女","birthDate":1989-11-03,"rxDate":"2007-09-02",isParty:"是","className":"信息0701班","notes":""},
                {"name":"李菜菜","sex":001,"sexDisplay":"男","birthDate":1987-03-19,"rxDate":"2007-09-02",isParty:"是","className":"信息0701班","notes":""},
                {"name":"杨菜菜","sex":002,"sexDisplay":"女","birthDate":1990-10-22,"rxDate":"2007-09-02",isParty:"否","className":"信息0701班","notes":""},
                {"name":"丁菜菜","sex":002,"sexDisplay":"女","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"是","className":"信息0701班","notes":"单亲"},
                {"name":"曾菜菜","sex":002,"sexDisplay":"女","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"否","className":"信息0701班","notes":""},
                {"name":"毕菜菜","sex":001,"sexDisplay":"男","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"否","className":"信息0701班","notes":""},
                {"name":"裴菜菜","sex":001,"sexDisplay":"男","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"否","className":"信息0701班","notes":""},
                {"name":"刘菜菜","sex":001,"sexDisplay":"男","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"是","className":"信息0701班","notes":""},
                {"name":"吴菜菜","sex":001,"sexDisplay":"男","birthDate":1988-09-20,"rxDate":"2007-09-02",isParty:"否","className":"信息0701班","notes":""}
            ],
            opColumn:{template:"<a href='javascript:alert(1)'>Say Hi</a> | " +
                                "<a href='javascript:deleteActive();'>Delete This Row</a> | " +
                                "<a href='javascript:editRow();'>Edit This Row</a>"},
            //行编辑
            canEdit:true,
            clickToEditRow:false,
            dbClickToEditField:true,
            editRowFunc:function(vm,row,rowDom){
                alert("row~~~~");
                myEditPro(vm,row,rowDom);
            },//编辑行事件
            editFieldFunc:function(vm,row,fieldName,fieldXtype,tdDom){
                var rowData = null;
                var datas = vm.data;
                var dataArr = [];
                for(var t=0;t<datas.length;t++){
                    if(datas[t]==row){
                        datas[t].state = "edit";
                        if(!datas[t]["editContent_"+fieldName]){
                            datas[t]["editContent_"+fieldName]= "<div id='__currentEditField'></div>";
                        }
                    }
                    dataArr.push(datas[t]);
                }
                vm.data = dataArr;
                if(true){//根据类型判断渲染何种组件,fieldXtype
                    var editField = Page.create("input", {
                        $parentId: '__currentEditField',
                        value: row[fieldName],
                        showLabel: false,
                        valueChange:function(){
                            row[fieldName] = editField.getValue();
                        }
                    });
                    editField.render();
                    editField._getInputElement().onblur = function(){
                        var dataArr = [];
                        for(var t=0;t<datas.length;t++){
                            if(datas[t]==row){
                                datas[t].state = "view";
                                datas[t][fieldName] = editField.getValue();
                                datas[t]["editContent_"+fieldName]= "";
                            }
                            dataArr.push(datas[t]);
                        }
                        vm.data = dataArr;
                    };
                }

            }//编辑单属性事件
        });
        simpleGrid.render();

    });
    function addRow(){
        simpleGrid.addRow({"name":"南农保安","sex":0,"sexDisplay":"未知"},1);
    }
    function delCheckedRow(){
        simpleGrid.deleteCheckedRows();
    }
    function delCustomRow(aid){
        simpleGrid.deleteRowByDataId(aid);
    }
    function deleteActive(){
        simpleGrid.deleteActiveRow();
    }
    function editRow(){
        alert("执行自定义的行编辑操作");
        myEditPro(simpleGrid,simpleGrid.getActiveRow(),simpleGrid.getActiveRowDom());
    }

    function myEditPro(vm,row,rowDom){
        if(rowDom&&rowDom.children&&rowDom.children.length>0){
            //rowDom
            for(var s=0;s<rowDom.children.length;s++){
                var fiedObj = rowDom.children[s];
                if(fiedObj.bindField){
                    //fiedObj
                }
            }
        }
    }

</script>
<!--<script src="bower_components/avalon/avalon.js" ></script>-->
<!--<script src="dist/page-build.js" data-main="demo.js"></script>-->
</body>
</html>